<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard monitoring routeurs</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">
    <div class="container py-4">
        <div class="mb-4">
            <h1 class="display-5 fw-bold text-primary">
                </i> Dashboard Monitoring des routeurs
            </h1>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted text-uppercase">Routeurs totaux</h6>
                        <h2 class="card-title display-4 fw-bold text-primary">{{ overview.total_routers }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center h-100 border-success">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted text-uppercase">Routeurs UP</h6>
                        <h2 class="card-title display-4 fw-bold text-success">{{ routers_up }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center h-100 border-danger">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted text-uppercase">Routeurs DOWN</h6>
                        <h2 class="card-title display-4 fw-bold text-danger">{{ routers_down }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted text-uppercase">Dispo moyenne</h6>
                        <h2 class="card-title display-4 fw-bold text-info">{{ avg_availability }}%</h2>
                    </div>
                </div>
            </div>
        </div>

        {% if overview.routers %}
        <!-- Liste des routeurs -->
        <h3 class="mb-3">Détails des routeurs</h3>
        <div class="row g-3 mb-4">
            {% for router in overview.routers %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center bg-white">
                        <div>
                            <h5 class="card-title mb-0">
                                Routeur #{{ router.router_id }}
                            </h5>
                            <small class="text-muted d-block">{{ router.router_ip }}</small>
                            {% if router.router_hostname %}
                            <small class="text-muted d-block">{{ router.router_hostname }}</small>
                            {% endif %}
                        </div>
                        <div>
                            {% if router.is_reachable == True %}
                            <span class="badge bg-success px-3 py-2">
                                <i class="bi bi-check-circle-fill"></i> UP
                            </span>
                            {% elif router.is_reachable == False %}
                            <span class="badge bg-danger px-3 py-2">
                                <i class="bi bi-x-circle-fill"></i> DOWN
                            </span>
                            {% else %}
                            <span class="badge bg-secondary px-3 py-2">
                                <i class="bi bi-question-circle-fill"></i> UNKNOWN
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="p-2 bg-light rounded">
                                    <small class="text-muted d-block">Disponibilité 24h</small>
                                    <strong class="
                                        {% if router.availability_24h_percent %}
                                            {% if router.availability_24h_percent >= 99 %}text-success
                                            {% elif router.availability_24h_percent >= 95 %}text-warning
                                            {% else %}text-danger{% endif %}
                                        {% endif %}
                                    ">
                                        {% if router.availability_24h_percent %}{{ router.availability_24h_percent }}%{% else %}N/A{% endif %}
                                    </strong>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-2 bg-light rounded">
                                    <small class="text-muted d-block">Temps réponse</small>
                                    <strong>
                                        {% if router.response_time_ms %}{{ router.response_time_ms|round(1) }} ms{% else %}N/A{% endif %}
                                    </strong>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-6">
                                <div class="p-2 bg-light rounded">
                                    <small class="text-muted d-block">Uptime</small>
                                    <strong>
                                        {% if router.uptime_seconds %}
                                            {% set days = (router.uptime_seconds // 86400)|int %}
                                            {% set hours = ((router.uptime_seconds % 86400) // 3600)|int %}
                                            {{ days }}j {{ hours }}h
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </strong>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-2 bg-light rounded">
                                    <small class="text-muted d-block">Dernier check</small>
                                    <strong style="font-size: 0.85em;">
                                        {% if router.last_check %}
                                            {{ router.last_check[:19].replace('T', ' ') }}
                                        {% else %}
                                            Jamais
                                        {% endif %}
                                    </strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info text-center py-5" role="alert">
            <i class="bi bi-info-circle display-1 d-block mb-3"></i>
            <h2>Aucun routeur trouvé</h2>
            <p class="mb-0">Ajoutez des routeurs pour commencer le monitoring</p>
        </div>
        {% endif %}


    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Auto-refresh toutes les 60 secondes -->
    <script>
        setTimeout(function() {
            location.reload();
        }, 60000);
    </script>

</body>
</html>
